from django.db import models
from main.models import  MUnit,  MResidence,MOccupation,MEducation,MaritalStatus,MReligion

class MfamilyAs(models.Model):
    id = models.AutoField(primary_key=True,db_column='id')
    name = models.CharField(max_length=50, null=True, blank=True)
    created_by = models.IntegerField(null=True, blank=True)
    created_on = models.DateTimeField(auto_now_add=True)

    class Meta:
        db_table = 'm_family_as'
    def __str__(self):
        return self.name 
    
class Warga(models.Model):
    
    GENDER_CHOICES = [
        (1, 'Laki-laki'),
        (2, 'Perempuan'),
    ]
    
    id = models.BigAutoField(primary_key=True)
    user = models.ForeignKey('MUser', on_delete=models.CASCADE, null=True, blank=True, db_column="user_id",related_name='user_warga')
    nik = models.CharField(max_length=16, null=True, blank=True, verbose_name='NIK')
    full_name = models.CharField(max_length=150, null=True, blank=True, verbose_name='Nama Lengkap')
    gender_id = models.IntegerField(choices=GENDER_CHOICES, null=True, blank=True, verbose_name='Jenis Kelamin')
    date_of_birth = models.DateField(null=True, blank=True, verbose_name='Tanggal Lahir')
    place_of_birth = models.CharField(max_length=150, null=True, blank=True, verbose_name='Tempat Lahir')
    marital_status = models.ForeignKey(MaritalStatus, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Status Pernikahan', db_column='marital_status_id')
    religion = models.ForeignKey(MReligion, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Agama', db_column='religion_id')
    phone_no = models.CharField(max_length=15, null=True, blank=True, verbose_name='Nomor telepon')
    residence = models.ForeignKey(MResidence, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Residence', db_column='residence_id')
    unit_id = models.ForeignKey(MUnit, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Unit', db_column='unit_id')
    occupation = models.ForeignKey(MOccupation, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Pekerjaan')
    education = models.ForeignKey(MEducation, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Pendidikan')
    profile_photo = models.ImageField(upload_to='profile_photos/', null=True, blank=True, verbose_name='Foto Profil')
    marriagePhoto = models.ImageField(upload_to='marriage_photo/', null=True, blank=True, verbose_name='Foto Marriage',db_column="marriage_photo")
    is_checker = models.BooleanField(default=False, verbose_name='Diketahui oleh pengurus')
    family_as = models.ForeignKey(MfamilyAs, on_delete=models.CASCADE, null=True, blank=True, verbose_name='Peran Keluarga', db_column='family_as')
    is_lead = models.BooleanField(default=False, verbose_name='Kepala Keluarga')
    created_by = models.BigIntegerField(null=False, blank=False, verbose_name='Dibuat Oleh')
    created_on = models.DateTimeField(auto_now_add=True, verbose_name='Dibuat Pada')
    modified_by = models.IntegerField(null=True, blank=True, verbose_name='Diperbarui Oleh')
    modified_on = models.DateTimeField(auto_now=True, null=True, blank=True, verbose_name='Diperbarui Pada')
    isactive = models.BooleanField(default=False, verbose_name='Aktif')
    isdelete = models.BooleanField(default=False, verbose_name='Dihapus')
    isreject = models.BooleanField(default=False, verbose_name='Rejected')
    checked_on = models.DateTimeField(null=True, blank=True,default=None, verbose_name='Di setujui pada')


    def __str__(self):
        return self.full_name or 'No fullname set'
    class Meta:
        db_table = 'm_warga'
        verbose_name = 'Warga'
        verbose_name_plural = 'Warga'
        
class WargaRejectionLog(models.Model):
    warga = models.ForeignKey('Warga', on_delete=models.CASCADE, related_name='rejections')
    reason = models.TextField()
    rejected_by = models.IntegerField(null=True, blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    def __str__(self):
        return f"Rejection for Warga {self.warga.id} by {self.rejected_by.username} at {self.created_at}"
    class Meta:
        db_table = 'warga_rejection_log'
        verbose_name = 'warga rejection log'
        verbose_name_plural = 'warga rejection log'